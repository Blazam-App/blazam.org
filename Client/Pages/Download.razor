@page "/download"
@using Octokit;

<PageTitle>Download - Blazam</PageTitle>
<MudText Typo=Typo.h1>Download</MudText>
<Badges />

<MudText Class="mt-5" Typo=Typo.h4>Requirements</MudText>
<MudContainer Class="ps-4">
    <UnorderedListItem>Microsoft Windows Server/Desktop</UnorderedListItem>
    <UnorderedListItem>Active Directory Services</UnorderedListItem>
</MudContainer>



    <MudText Class="mt-5" Typo=Typo.h4>Web Installer (Recommended)</MudText>
    <MudAlert  Style="max-width:300px" Class="mud-alert-filled-warning">

            The Web Installer is not yet finished. Please check back around May 2023
            if you want an easy installation.
    </MudAlert>
    <MudText>
        Installing via the Web Installer is the recommended method as it performs all
        required pre-installation checks automatically, and configures the application to launch
        based on the chosen installation type.
    </MudText>
    <MudText>
        The Web Installer allows installing the application to a new IIS Application Pool, or as a stand-alone service installed under
        Program Files.
    </MudText>
    <MudButton OnClick=DownloadMSI Color="Color.Primary">Download Web Installer</MudButton>




<MudText Class="mt-5" Typo=Typo.h4>Manual Installation</MudText>
    <MudText>
        If you need to install in a way that the Web Installer does not allow, or you're feeling particularly adventerous, use the manual
        installation method. This method requires you to manually set up database connections and your web hosting solution.
    </MudText>
    @if (Error == "")
    {
        if (latestDownload != null)
        {
            <br />
            <MudStack Row=true>
            <MudLink Href="@latestDownload.DownloadUri" Target="Target.Blank">
                <MudButton Color="Color.Primary">Download Zip</MudButton>

            </MudLink>
            <Help>Version: @latestDownload.Version</Help>

            </MudStack>
           
            <br />
            <br />
            <br />
            <MudLink Href="https://docs.blazam.org/install/manual/" Target=Target.Blank>
                <MudButton Color=Color.Primary>Install Instructions</MudButton>
            </MudLink>
        }
        else
        {
            <MudText>Getting latest version...</MudText>
        }
    }
    else
    {
        <MudAlert >
                Error collecting latest version from GitHub.
        </MudAlert>
    }


@code {
    [CascadingParameter]
    public MainLayout Layout { get; set; }
    ManualDownload latestDownload;
    string downloadUri = "";
    string Error = "";
    async Task DownloadMSI()
    {
        if (await DialogService.ShowMessageBox(
             "Broken Installer",
        "The MSI installer is incomplete. It will install the files for" +
        " you but it is incapable of configuring IIS currently." +
        "  Are you sure you want to install this way?",
        yesText: "Download Anyway",
        noText: "I'll wait"
        )==true)
        {
            Nav.NavigateTo("/files/BLAZAM.msi", true);
        }
    }
    protected override async Task OnInitializedAsync()
    {
        await base.OnInitializedAsync();
        latestDownload = await Update.GetLatestUpdateUri();
        await InvokeAsync(StateHasChanged);
    }
}
